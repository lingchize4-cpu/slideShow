<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">

<style>

  /* ===============================
   Ê®™ÁîªÈù¢Â∞ÇÁî®„É¨„Ç§„Ç¢„Ç¶„Éà
   =============================== */
@media (orientation: landscape) {

    /* UIÂÖ®‰Ωì„ÇíÂ∞ë„Åó‰ΩôË£ïÊåÅ„Åü„Åõ„Çã */
    #container {
        padding: 8px;
        box-sizing: border-box;
    }

    /* ÁîªÂÉèÁï™Âè∑ */
    #imageNumber {
        top: 12px;
        left: 12px;
        font-size: 18px;
    }

    /* „Çø„Ç§„Éû„ÉºË°®Á§∫ */
    #timerDisplay {
        top: 12px;
        left: 110px;
        font-size: 18px;
    }

    #timerInput {
        top: 12px;
        left: 110px;
        font-size: 16px;
    }

    #timerSetBtn {
        top: 12px;
        left: 190px;
    }

    /* „É¢„Éº„Éâ„ÉªFINISH„ÉªBPM */
    #modeBtn {
        top: 12px;
        right: 340px;
        font-size: 15px;
    }

    #finishBtn {
        top: 12px;
        right: 250px;
        font-size: 15px;
    }

    #bpmInput {
        top: 12px;
        right: 170px;
        width: 70px;
        font-size: 15px;
    }

    /* STOP */
    #pauseBtn {
        top: 12px;
        right: 12px;
        font-size: 15px;
    }

    /* Èü≥ÈáèUI ‚Üí Âè≥ÂÅ¥‰∏≠Â§Æ */
    #volumeArea {
        top: 50%;
        right: 14px;
        transform: translateY(-50%);
        background: rgba(0,0,0,0.35);
        padding: 8px;
        border-radius: 8px;
        font-size: 13px;
    }

    #volumeArea input {
        width: 160px;
    }

    /* BGM„Ç∑„Éº„ÇØ„ÅØÂ∞ë„Åó‰∏ä„Å´ */
    #bgmSeekArea {
        bottom: 16px;
        width: 85%;
    }
}

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
}

#container {
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}

#slideshow {
    width: 100%;
    height: 100%;
    /*object-fit: cover; /* ÁîªÈù¢ÊúÄÂ§ß */
    object-fit: contain; /* ÁîªÈù¢ÂÜÖ„Å´Âèé„Åæ„Çã */
    transform-origin: center;
}

/* UI */
#imageNumber {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 30;
    color: white;
    font-size: 16px;
    background: rgba(0,0,0,0.5);
    padding: 4px 8px;
    border-radius: 6px;
}

#pauseBtn, #modeBtn, #finishBtn {
    position: absolute;
    top: 10px;
    z-index: 30;
    padding: 6px 10px;
    border-radius: 8px;
    border: none;
    color: white;
    font-size: 14px;
}

#modeBtn { right: 250px; background: rgba(0,0,0,0.6); }
#finishBtn { right: 170px; background: rgba(140,0,140,0.7); }
#pauseBtn { right: 10px; background: rgba(0,0,0,0.6); }

#bpmInput {
    position: absolute;
    top: 10px;
    right: 95px;
    width: 60px;
    z-index: 30;
    border-radius: 6px;
    border: none;
    padding: 4px;
    text-align: center;
    font-size: 14px;
}

/* ===== Èü≥ÈáèUI ===== */
#volumeArea {
    position: absolute;
    top: 48px;
    right: 10px;
    z-index: 30;
    color: white;
    font-size: 12px;
}

#volumeArea input {
    width: 140px;
}

/* ===== BGM„Ç∑„Éº„ÇØ ===== */
#bgmSeekArea {
    position: absolute;
    bottom: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    z-index: 30;
    color: white;
    font-size: 12px;
}

#bgmSeek {
    width: 100%;
}

/* ===== È°çÁ∏ÅÈ¢® „Éî„É≥„ÇØ„Ç®„Éï„Çß„ÇØ„Éà ===== */
.corner {
    position: absolute;
    width: 40vmin;
    height: 40vmin;
    opacity: 0;
    pointer-events: none;
    z-index: 20;
}

/* Â∑¶‰∏ä */
.top-left {
    top: 0;
    left: 0;
    background: linear-gradient(135deg,
        rgba(255,120,170,0.45),
        rgba(255,120,170,0.15),
        rgba(255,120,170,0)
    );
    clip-path: polygon(0 0, 100% 0, 0 100%);
}

/* Âè≥‰∏ä */
.top-right {
    top: 0;
    right: 0;
    background: linear-gradient(225deg,
        rgba(255,120,170,0.45),
        rgba(255,120,170,0.15),
        rgba(255,120,170,0)
    );
    clip-path: polygon(100% 0, 0 0, 100% 100%);
}

/* Â∑¶‰∏ã */
.bottom-left {
    bottom: 0;
    left: 0;
    background: linear-gradient(45deg,
        rgba(255,120,170,0.45),
        rgba(255,120,170,0.15),
        rgba(255,120,170,0)
    );
    clip-path: polygon(0 100%, 0 0, 100% 100%);
}

/* Âè≥‰∏ã */
.bottom-right {
    bottom: 0;
    right: 0;
    background: linear-gradient(315deg,
        rgba(255,120,170,0.45),
        rgba(255,120,170,0.15),
        rgba(255,120,170,0)
    );
    clip-path: polygon(100% 100%, 0 100%, 100% 0);
}

/* Êãç„ÅßÂÖâ„Çã */
@keyframes framePulse {
    0% { opacity: 0; }
    20% { opacity: 1; }
    100% { opacity: 0; }
}
.pulse {
    animation: framePulse 0.45s ease-out;
}

@keyframes beatMove {
    0% { transform: scale(1); }
    30% {
        transform: scale(var(--zoom))
        translate(var(--x), var(--y))
        rotate(var(--r));
    }
    100% { transform: scale(1); }
}
.beat { animation: beatMove 0.45s ease-out; }
</style>
</head>
<body>

<div id="container">
    <img id="slideshow">

    <div id="controlUI">
      <div id="imageNumber"></div>

      <button id="modeBtn">RANDOM</button>
      <button id="finishBtn">FINISH</button>
      <input id="bpmInput" type="number">
      <button id="pauseBtn">‚è∏ STOP</button>

      

    <button id="restBtn">REST</button>
    <button id="restoreBtn" disabled>BACK</button>

      <!-- „Çø„Ç§„Éû„ÉºË°®Á§∫ -->
      <div id="timerDisplay"
          style="position:absolute; top:10px; left:120px; z-index:30;
                  color:white; background:rgba(0,0,0,0.5);
                  padding:4px 8px; border-radius:6px;">
          10:00
      </div>

      <!-- „Çø„Ç§„Éû„ÉºË®≠ÂÆö -->
      <input id="timerInput" type="number" min="1"
          style="position:absolute; top:10px; left:190px; width:60px;
                  z-index:30; display:none;">

      <button id="timerSetBtn"
              style="position:absolute; top:10px; left:260px; z-index:30;
                  border:none; border-radius:8px;
                  background:rgba(0,0,0,0.6); color:white;
                  padding:6px 10px;">
          TIMER
      </button>

      <button id="videoBtn"
          style="position:absolute; top:10px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(0,0,0,0.6); color:white;
                padding:6px 10px;">
          VIDEO
      </button>

      <button id="phaseUpBtn"
          style="position:absolute; top:50px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(0,120,255,0.7); color:white;
                padding:6px 10px;">
          PHASE +
      </button>

      <button id="phaseDownBtn"
          style="position:absolute; top:90px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(255,120,0,0.7); color:white;
                padding:6px 10px;">
          PHASE -
      </button>

      <div id="phaseCounter"
      style="position:absolute; top:130px; right:330px; z-index:30;
              color:white; background:rgba(0,0,0,0.6);
              padding:6px 12px; border-radius:8px;
              font-size:18px; text-align:center;">
      0
      </div>

      <!-- „Ç´„Ç¶„É≥„Çø„ÉºÊìç‰Ωú -->
      <button id="countUpBtn"
          style="position:absolute; top:180px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(0,180,120,0.8); color:white;
                padding:6px 10px;">
          COUNT +
      </button>

      <button id="countDownBtn"
          style="position:absolute; top:220px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(180,60,60,0.8); color:white;
                padding:6px 10px;">
          COUNT -
      </button>

      <button id="countApplyBtn"
          style="position:absolute; top:260px; right:330px; z-index:30;
                border:none; border-radius:8px;
                background:rgba(255,200,0,0.85); color:black;
                padding:6px 10px;">
          APPLY
      </button>
      
      

    <!-- Èü≥Èáè -->
    <div id="volumeArea">
        BGM<br>
        <input id="bgmVolume" type="range" min="0" max="1" step="0.01" value="0.5"><br>
        BPM<br>
        <input id="bpmVolume" type="range" min="0" max="1" step="0.01" value="0.5">
    </div>

    <!-- BGM„Ç∑„Éº„ÇØ -->
    <div id="bgmSeekArea">
        <input id="bgmSeek" type="range" min="0" max="100" value="0">
    </div>

    <div class="corner top-left"></div>
    <div class="corner top-right"></div>
    <div class="corner bottom-left"></div>
    <div class="corner bottom-right"></div>

    <iframe id="videoFrame"
        style="
            position:absolute;
            top:0; left:0;
            width:100%; height:100%;
            z-index:15;
            display:none;
            border:none;
            background:black;"
        allow="autoplay; encrypted-media"
        allowfullscreen>
    </iframe>
  </div>
</div>

<button id="uiToggleBtn"
    style="position:absolute; bottom:20px; right:20px;
           z-index:40;
           border:none; border-radius:10px;
           background:rgba(0,0,0,0.7);
           color:white; padding:10px 14px;">
    UI HIDE
</button>

<audio id="metronome" src="sound/metronome.mp3"></audio>
<audio id="bgmSound" src="sound/bgm.mp3" loop></audio>
<audio id="finishSound" src="sound/finish.mp3"></audio>

<script>
/* ===== Ë®≠ÂÆö ===== */
const imageCount = 183;
const imageFolder = "Image";
const minInterval = 3000;
const maxInterval = 5000;

/* ===== Áä∂ÊÖã ===== */
let isPaused = false;
let isRandomMode = true;
let isFinished = false;
let BPM = 30;

let imageTimer = null;
let metroTimer = null;
let bpmTimer = null;

let bgmVol = 0.5;
let bpmVol = 0.5;

let audioCtx = null;
let useDefaultBeep = false;

let isVideoMode = false;

let phase = 1;
let phaseTimer = null;
let phaseDuration = 60 * 1000;

let phaseCount = 0;

let isUIVisible = true;

let isRestMode = false;
let savedPhase = null;

/* ===== Timer ===== */
let timerSeconds = 600;
let timerInterval = null;
let isTimerSetting = false;

/* ===== DOM ===== */
const slideshow = document.getElementById("slideshow");
const imageNumber = document.getElementById("imageNumber");
const pauseBtn = document.getElementById("pauseBtn");
const modeBtn = document.getElementById("modeBtn");
const finishBtn = document.getElementById("finishBtn");
const bpmInput = document.getElementById("bpmInput");

const bgmVolume = document.getElementById("bgmVolume");
const bpmVolume = document.getElementById("bpmVolume");
const bgmSeek = document.getElementById("bgmSeek");

const metronome = document.getElementById("metronome");
const bgmSound = document.getElementById("bgmSound");
const finishSound = document.getElementById("finishSound");
const corners = document.querySelectorAll(".corner");

const timerDisplay = document.getElementById("timerDisplay");
const timerInput = document.getElementById("timerInput");
const timerSetBtn = document.getElementById("timerSetBtn");

const videoBtn = document.getElementById("videoBtn");
const videoFrame = document.getElementById("videoFrame");

const phaseUpBtn = document.getElementById("phaseUpBtn");
const phaseDownBtn = document.getElementById("phaseDownBtn");

const phaseCounter = document.getElementById("phaseCounter");
const countUpBtn = document.getElementById("countUpBtn");
const countDownBtn = document.getElementById("countDownBtn");
const countApplyBtn = document.getElementById("countApplyBtn");

const controlUI = document.getElementById("controlUI");
const uiToggleBtn = document.getElementById("uiToggleBtn");

const restBtn = document.getElementById("restBtn");
const restoreBtn = document.getElementById("restoreBtn");

const rand = (a,b)=>Math.random()*(b-a)+a;

/* ===== Èü≥Èáè ===== */
bgmVolume.oninput = ()=>{
    bgmVol = bgmVolume.value;
    bgmSound.volume = bgmVol;
    finishSound.volume = bgmVol;
};

bpmVolume.oninput = ()=>{
    bpmVol = bpmVolume.value;
    metronome.volume = bpmVol;
};

/* ===== BGM„Ç∑„Éº„ÇØ ===== */
bgmSound.addEventListener("timeupdate", ()=>{
    if (!bgmSound.duration) return;
    bgmSeek.value = (bgmSound.currentTime / bgmSound.duration) * 100;
});

bgmSeek.oninput = ()=>{
    if (!bgmSound.duration) return;
    bgmSound.currentTime = (bgmSeek.value / 100) * bgmSound.duration;
};

/* ===== Image ===== */
function scheduleNextImage() {
    if (isPaused) return;
    imageTimer = setTimeout(showNextImage, rand(minInterval,maxInterval));
}

function showNextImage() {
    if (isPaused) return;
    const i = Math.floor(Math.random()*imageCount)+1;
    slideshow.src = `${imageFolder}/Image${i}.jpg`;
    imageNumber.textContent = i;
    scheduleNextImage();
}

/* ===== Beep ===== */
function playDefaultBeep() {
    if (!audioCtx) audioCtx = new AudioContext();

    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    osc.type = "sine";
    osc.frequency.value = 60;

    gain.gain.setValueAtTime(bpmVol * 0.35, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.3);

    osc.connect(gain);
    gain.connect(audioCtx.destination);

    osc.start();
    osc.stop(audioCtx.currentTime + 0.32);
}

/* ===== Beat ===== */
function triggerBeatEffect() {
    corners.forEach(c=>{
        c.classList.remove("pulse");
        void c.offsetWidth;
        c.classList.add("pulse");
    });

    const move = isFinished ? 8 : 4;
    const rot  = isFinished ? 1.2 : 0.6;
    const zoom = isFinished ? 1.06 : 1.03;

    slideshow.style.setProperty("--x", `${rand(-move,move)}px`);
    slideshow.style.setProperty("--y", `${rand(-move,move)}px`);
    slideshow.style.setProperty("--r", `${rand(-rot,rot)}deg`);
    slideshow.style.setProperty("--zoom", zoom);

    slideshow.classList.remove("beat");
    void slideshow.offsetWidth;
    slideshow.classList.add("beat");
}

function playBeat() {
    if (isPaused) return;
    triggerBeatEffect();

    if (useDefaultBeep) playDefaultBeep();
    else {
        metronome.currentTime = 0;
        metronome.volume = bpmVol;
        metronome.play().catch(()=>{
            useDefaultBeep = true;
            playDefaultBeep();
        });
    }
}

/* ===== BPM ===== */
function restartMetro() {
    clearInterval(metroTimer);
    metroTimer = setInterval(playBeat, 60000 / BPM);
    bpmInput.value = BPM;
}

// function startRandomBPM() {
//   /* „É©„É≥„ÉÄ„É†„Å™„Éì„Éº„Éà„ÅÆÁÆ°ÁêÜ */
//     clearInterval(bpmTimer);
//     function update() {
//         BPM = Math.floor(rand(15,121));
//         restartMetro();
//     }
//     update();
//     bpmTimer = setInterval(update, 10000);
// }

function startFixedBPM() {
    clearInterval(bpmTimer);
    BPM = Number(bpmInput.value) || BPM;
    restartMetro();
}

/* ===== UI ===== */
modeBtn.onclick = ()=>{
    if (isFinished) return;
    isRandomMode = !isRandomMode;
    modeBtn.textContent = isRandomMode ? "RANDOM" : "FIXED";
    bpmInput.disabled = isRandomMode;
    isRandomMode ? startPhaseSystem() : startFixedBPM();
};

pauseBtn.onclick = ()=>{
    if (!isPaused) {
        isPaused = true;
        clearTimeout(imageTimer);
        clearInterval(metroTimer);
        clearInterval(bpmTimer);
        bgmSound.pause();
        stopTimer();
        pauseBtn.textContent = "‚ñ∂ PLAY";
    } else {
        isPaused = false;
        scheduleNextImage();
        isRandomMode ? startPhaseSystem() : startFixedBPM();
        startTimer();
        bgmSound.play().catch(()=>{});
        pauseBtn.textContent = "‚è∏ STOP";
    }
};

finishBtn.onclick = ()=>{
    isFinished = true;

    clearInterval(bpmTimer);
    isRandomMode = false;
    modeBtn.textContent = "FINISH";
    bpmInput.disabled = true;

    BPM = 240;
    restartMetro();

    bgmSound.pause();
    bgmSound.currentTime = 0;

    finishSound.currentTime = 0;
    finishSound.volume = bgmVol;
    finishSound.play().catch(()=>{});
};

/* ===== Start ===== */
showNextImage();
document.body.addEventListener("click", ()=>{
    bgmSound.volume = bgmVol;
    bgmSound.play().catch(()=>{});
    startPhaseSystem();
}, { once:true });

function updateTimerDisplay() {
    const m = String(Math.floor(timerSeconds / 60)).padStart(2, "0");
    const s = String(timerSeconds % 60).padStart(2, "0");
    timerDisplay.textContent = `${m}:${s}`;
}

function startTimer() {
    if (timerInterval || isTimerSetting) return;

    timerInterval = setInterval(() => {
        if (isPaused) return;

        timerSeconds--;
        updateTimerDisplay();

        if (timerSeconds <= 0) {
            stopTimer();
            finishBtn.onclick();
        }
    }, 1000);
}

function stopTimer() {
    clearInterval(timerInterval);
    timerInterval = null;
}

function resetTimer(sec) {
    stopTimer();
    timerSeconds = sec;
    updateTimerDisplay();
}

timerSetBtn.onclick = () => {
    isTimerSetting = !isTimerSetting;

    if (isTimerSetting) {

        stopTimer();
        timerInput.style.display = "inline";
        timerInput.value = Math.floor(timerSeconds / 60);
        timerDisplay.style.display = "none";
        timerSetBtn.textContent = "SET";
    } else {

        const min = Math.max(1, Number(timerInput.value));
        resetTimer(min * 60);

        timerInput.style.display = "none";
        timerDisplay.style.display = "inline";
        timerSetBtn.textContent = "TIMER";

        isTimerSetting = false;
        startTimer();
    }
};

videoBtn.onclick = () => {
      console.log("a");

      if (!isVideoMode) {
          /* ===== VIDEO„É¢„Éº„Éâ„Å∏ ===== */
          isVideoMode = true;
          videoBtn.textContent = "SLIDE";

          videoFrame.src =`https://rule34video.com/embed/3860625`;

          videoFrame.style.display = "block";

      } else {
          /* ===== SLIDE„É¢„Éº„Éâ„Å∏ ===== */
          isVideoMode = false;
          videoBtn.textContent = "VIDEO";

          videoFrame.src = "";
          videoFrame.style.display = "none";

          isPaused = false;
          scheduleNextImage();
          startTimer();
          isRandomMode ? startPhaseSystem() : startFixedBPM();
          bgmSound.play().catch(()=>{});
      }
  };

  function startPhaseSystem() {
    phase = 1;
    runPhase();
    phaseTimer = setInterval(() => {
        phase++;
        runPhase();
    }, phaseDuration);
}

function getPhaseBpmRange(phase) {
    const min = 10 + (phase - 1) * 10;
    const max = 20 + (phase - 1) * 10;
    return { min, max };
}

function runPhase() {
    const { min, max } = getPhaseBpmRange(phase);

    // ÈÄöÂ∏∏BPM
    BPM = Math.floor(rand(min, max));
    restartMetro();

    console.log(
        `[PHASE START] „Éï„Çß„Éº„Ç∫:${phase} | ÈÄöÂ∏∏BPM:${BPM} (${min}„Äú${max})`
    );

    // Ââ≤„ÇäËæº„Åø„Éì„Éº„Éà‰∫àÁ¥Ñ
    scheduleBurstBeat();
}

function scheduleBurstBeat() {
    const delay = rand(0, 50) * 1000; // 0„Äú50ÁßíÂæå„ÅÆ„Å©„Åì„Åã

    setTimeout(() => {
        startBurstBeat();
    }, delay);
}

function startBurstBeat() {
    const originalBPM = BPM;

    BPM = Math.floor(rand(60, 121));
    restartMetro();

    console.log(
        `üî• [BURST START] „Éï„Çß„Éº„Ç∫:${phase} | „Éê„Éº„Çπ„ÉàBPM:${BPM} (10Áßí)`
    );

    // 10ÁßíÂæå„Å´ÂÖÉ„Å´Êàª„Åô
    setTimeout(() => {
        const { min, max } = getPhaseBpmRange(phase);
        BPM = Math.floor(rand(min, max));
        restartMetro();

        console.log(
            `‚Ü©Ô∏è [BURST END] „Éï„Çß„Éº„Ç∫:${phase} | ÈÄöÂ∏∏BPMÂæ©Â∏∞:${BPM} (${min}„Äú${max})`
        );
    }, 10000);
}

function applyPhaseChange() {
    clearInterval(bpmTimer); // Âøµ„ÅÆ„Åü„ÇÅ
    runPhase();

    console.log(
        `%c[MANUAL] „Éï„Çß„Éº„Ç∫:${phase} | BPM:${BPM}`,
        "color:#00ffff;font-weight:bold"
    );
}

phaseUpBtn.onclick = () => {
    phase++;
    console.log(`‚¨ÜÔ∏è ÊâãÂãï„Éï„Çß„Éº„Ç∫„Ç¢„ÉÉ„Éó ‚Üí ${phase}`);
    applyPhaseChange();
};

phaseDownBtn.onclick = () => {
    phase = Math.max(1, phase - 1);
    console.log(`‚¨áÔ∏è ÊâãÂãï„Éï„Çß„Éº„Ç∫„ÉÄ„Ç¶„É≥ ‚Üí ${phase}`);
    applyPhaseChange();
};

updatePhaseCounter();

function updatePhaseCounter() {
    phaseCounter.textContent = phaseCount;
}

countUpBtn.onclick = () => {
    phaseCount = Math.min(10, phaseCount + 1);
    updatePhaseCounter();
};

countDownBtn.onclick = () => {
    phaseCount = Math.max(0, phaseCount - 1);
    updatePhaseCounter();
};

countApplyBtn.onclick = () => {

    if (phaseCount === 0) {
        console.log("‚ö† „Éï„Çß„Éº„Ç∫0„ÅØÁÑ°Âäπ„Åß„Åô");
        return;
    }

    phase = phaseCount;

    console.log(
        `%c[COUNTER APPLY] „Éï„Çß„Éº„Ç∫ÁßªË°å ‚Üí ${phase}`,
        "color:#ffcc00;font-weight:bold"
    );

    applyPhaseChange(); // Êó¢Â≠ò„ÅÆ„Éï„Çß„Éº„Ç∫Âç≥ÊôÇÂèçÊò†Èñ¢Êï∞
};

uiToggleBtn.onclick = () => {
    isUIVisible = !isUIVisible;

    controlUI.style.display = isUIVisible ? "block" : "none";
    uiToggleBtn.textContent = isUIVisible ? "UI HIDE" : "UI SHOW";

    console.log(
        `%c[UI] ${isUIVisible ? "Ë°®Á§∫" : "ÈùûË°®Á§∫"}`,
        "color:#66ccff;font-weight:bold"
    );
};

restBtn.onclick = () => {
    if (isRestMode) return;

    savedPhase = phase;   // ÂÖÉ„ÅÆ„Éï„Çß„Éº„Ç∫‰øùÂ≠ò
    phase = 1;            // „Éï„Çß„Éº„Ç∫1„Å∏
    isRestMode = true;

    restoreBtn.disabled = false;

    console.log(
        `%c[REST START] phase ‚Üí 1 (saved: ${savedPhase})`,
        "color:#00ffcc;font-weight:bold"
    );
};

function onPhaseMinuteEnd() {

    if (isRestMode) {
        console.log(
            "%c[REST] „Éï„Çß„Éº„Ç∫1ÁµÇ‰∫Ü ‚Üí Âæ©Â∏∞ÂæÖ„Å°",
            "color:orange;font-weight:bold"
        );
        return; // ‚òÖ Ëá™Âãï„Éï„Çß„Éº„Ç∫ÈÄ≤Ë°å„ÇíÊ≠¢„ÇÅ„Çã
    }

    phase++;
    console.log(`%c[PHASE UP] ‚Üí ${phase}`, "color:#66ff66");
}

restoreBtn.onclick = () => {
    if (!isRestMode || savedPhase === null) return;

    phase = savedPhase;

    isRestMode = false;
    savedPhase = null;

    restoreBtn.disabled = true;

    console.log(
        `%c[REST END] phase restored ‚Üí ${phase}`,
        "color:#ff66ff;font-weight:bold"
    );
};
</script>

</body>
</html>

